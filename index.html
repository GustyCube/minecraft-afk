<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>AFK Bot Dashboard</title>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background: #f0f2f5; color: #333; margin: 0; }
    header { background: #4a90e2; color: white; padding: 1rem; text-align: center; }
    main { display: flex; flex-wrap: wrap; padding: 1rem; gap: 1rem; }
    section { background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); padding: 1rem; flex: 1 1 300px; }
    h2, h3 { margin-top: 0; }
    #log { height: 200px; overflow-y: auto; background: #eef1f5; padding: 0.5rem; border-radius: 4px; }
    label { display: block; margin: 0.5rem 0 0.25rem; font-weight: 600; }
    input, select, textarea { width: 100%; padding: 0.5rem; border: 1px solid #ccc; border-radius: 4px; }
    input[type="checkbox"] { width: auto; }
    button { background: #4a90e2; color: white; border: none; padding: 0.75rem; border-radius: 4px; cursor: pointer; margin-top: 0.5rem; }
    button:hover { background: #357ab8; }
    form { margin: 0; }
  </style>
</head>
<body>
  <header><h1>AFK Bot Dashboard</h1></header>
  <main>
    <section>
      <h2>Accounts</h2>
      <form id="addAccountForm">
        <label for="newAccountUsername">Email</label>
        <input id="newAccountUsername" name="username" placeholder="new@example.com">
        <label for="newAccountAuth">Auth Type</label>
        <select id="newAccountAuth" name="auth">
          <option value="microsoft">Microsoft</option>
          <option value="mojang">Mojang</option>
        </select>
        <button type="submit">Add Account</button>
      </form>
      <h3>Switch Account</h3>
      <select id="accountSelect"></select>
    </section>
    <section>
      <h2>Status & AFK Logic</h2>
      <p><strong>Connected:</strong> <span id="status">…</span></p>
      <p><strong>User:</strong> <span id="user">…</span></p>
      <p><strong>Server:</strong> <span id="host">…</span>:<span id="port">…</span></p>
      <p><strong>Last AFK Cmd:</strong> <span id="lastAFK">…</span></p>
    </section>
    <section>
      <h2>Settings</h2>
      <form id="settingsForm">
        <label for="host">Host</label><input id="host" name="host">
        <label for="port">Port</label><input id="port" name="port" type="number">
        <label for="wiggleInterval">Wiggle interval (ms)</label><input id="wiggleInterval" name="wiggleInterval" type="number">
        <label for="wiggleAmplitude">Wiggle amplitude</label><input id="wiggleAmplitude" name="wiggleAmplitude" type="number" step="0.01">
        <label><input id="chatPingEnabled" name="chatPingEnabled" type="checkbox"> Enable chat ping</label>
        <label for="chatPingInterval">Chat ping interval</label><input id="chatPingInterval" name="chatPingInterval" type="number">
        <label for="chatPingMessage">Chat ping message</label><input id="chatPingMessage" name="chatPingMessage">
        <label for="afkRetryInterval">AFK retry interval</label><input id="afkRetryInterval" name="afkRetryInterval" type="number">
        <label for="selectedAccount">Active account</label><select id="selectedAccount" name="selectedAccount"></select>
        <button type="submit">Save & Restart</button>
      </form>
    </section>
    <section>
      <h2>Chat</h2>
      <form id="chatForm" style="display:flex; gap:0.5rem;"><input name="chat" placeholder="/afk 1 etc"><button type="submit">Send</button></form>
      <h3>Log</h3><div id="log"></div>
    </section>
  </main>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();
    const logEl = document.getElementById('log');
    const acctSelect = document.getElementById('accountSelect');
    const selAcct = document.getElementById('selectedAccount');
    let lastAFKCmd = null;

    function refreshAccounts(list, selected) {
      acctSelect.innerHTML = '';
      selAcct.innerHTML = '';
      list.forEach((a,i) => {
        const o1 = document.createElement('option'); o1.text = a.username; o1.value = i;
        const o2 = o1.cloneNode(true);
        acctSelect.add(o1);
        selAcct.add(o2);
      });
      acctSelect.selectedIndex = selected;
      selAcct.selectedIndex = selected;
    }

    socket.on('status', s => {
      refreshAccounts(s.accounts, s.selectedAccount);
      document.getElementById('status').textContent         = s.connected;
      document.getElementById('user').textContent           = s.username;
      document.getElementById('host').textContent           = s.host;
      document.getElementById('port').textContent           = s.port;
      document.getElementById('lastAFK').textContent        = lastAFKCmd || '—';
      document.forms.settingsForm.host.value                = s.host;
      document.forms.settingsForm.port.value                = s.port;
      document.forms.settingsForm.wiggleInterval.value      = s.wiggleInterval;
      document.forms.settingsForm.wiggleAmplitude.value     = s.wiggleAmplitude;
      document.forms.settingsForm.chatPingEnabled.checked   = s.chatPingEnabled;
      document.forms.settingsForm.chatPingInterval.value    = s.chatPingInterval;
      document.forms.settingsForm.chatPingMessage.value     = s.chatPingMessage;
      document.forms.settingsForm.afkRetryInterval.value    = s.afkRetryInterval;
      document.forms.settingsForm.selectedAccount.value     = s.selectedAccount;
    });

    socket.on('log', msg => {
      const line = document.createElement('div'); line.textContent = msg;
      logEl.appendChild(line); logEl.scrollTop = logEl.scrollHeight;
    });

    document.getElementById('addAccountForm').onsubmit = e => {
      e.preventDefault();
      const data = {
        username: e.target.username.value,
        auth:     e.target.auth.value
      };
      socket.emit('addAccount', data);
      e.target.reset();
    };

    document.getElementById('settingsForm').onsubmit = e => {
      e.preventDefault();
      const f = e.target;
      socket.emit('setSettings', Object.fromEntries(new FormData(f)));
    };

    document.getElementById('chatForm').onsubmit = e => {
      e.preventDefault();
      const txt = e.target.chat.value.trim();
      if (!txt) return;
      lastAFKCmd = txt;
      socket.emit('sendChat', txt);
      e.target.reset();
    };
  </script>
</body>
</html>
